<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bar da Tapioca</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FFD700;
            --secondary: #000000;
            --accent: #FFA500;
            --text-light: #FFFFFF;
            --text-dark: #000000;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--secondary);
            color: var(--text-light);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background-color: var(--secondary);
            border-bottom: 3px solid var(--primary);
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .logo {
            text-align: center;
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }

        /* Main Content */
        main {
            margin-top: 80px;
            min-height: calc(100vh - 160px);
        }

        /* Categorias */
        .categories {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 1rem 0;
            margin-bottom: 2rem;
        }

        .category-btn {
            background: var(--primary);
            color: var(--text-dark);
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .category-btn.active,
        .category-btn:hover {
            background: var(--accent);
            transform: translateY(-2px);
        }

        /* Produtos */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }

        .product-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--primary);
            border-radius: 15px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3);
        }

        .product-image {
            width: 100%;
            height: 150px;
            background: var(--primary);
            border-radius: 10px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-dark);
            font-weight: bold;
        }

        .product-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .product-description {
            font-size: 0.9rem;
            margin-bottom: 1rem;
            opacity: 0.8;
        }

        .product-price {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .add-to-cart {
            background: var(--primary);
            color: var(--text-dark);
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }

        .add-to-cart:hover {
            background: var(--accent);
        }

        /* Carrinho */
        .cart-sidebar {
            position: fixed;
            right: -400px;
            top: 0;
            width: 100%;
            max-width: 400px;
            height: 100vh;
            background: var(--secondary);
            border-left: 3px solid var(--primary);
            transition: right 0.3s ease;
            z-index: 1001;
            padding: 2rem;
            overflow-y: auto;
        }

        .cart-sidebar.open {
            right: 0;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 1rem;
        }

        .close-cart {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .cart-items {
            margin-bottom: 2rem;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
        }

        .item-info h4 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .item-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            background: var(--primary);
            color: var(--text-dark);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
        }

        .remove-item {
            background: #ff4444;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 1rem;
        }

        .cart-total {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            color: var(--primary);
            margin-bottom: 2rem;
        }

        .checkout-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: bold;
            color: var(--primary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid var(--primary);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            font-size: 1rem;
        }

        .payment-methods {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 1rem 0;
        }

        .payment-method {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid var(--primary);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .payment-method.selected {
            background: var(--primary);
            color: var(--text-dark);
        }

        .checkout-btn {
            background: var(--primary);
            color: var(--text-dark);
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .checkout-btn:hover {
            background: var(--accent);
            transform: translateY(-2px);
        }

        .cart-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary);
            color: var(--text-dark);
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: none;
        }

        .overlay.active {
            display: block;
        }

        /* Admin Styles */
        .admin-login {
            max-width: 400px;
            margin: 100px auto;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border: 2px solid var(--primary);
        }

        .admin-panel {
            display: none;
            padding: 2rem 0;
        }

        .orders-list {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .order-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--primary);
            border-radius: 10px;
            padding: 1rem;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--primary);
            padding-bottom: 0.5rem;
        }

        .order-actions {
            display: flex;
            gap: 10px;
            margin-top: 1rem;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-preparing {
            background: #ffa500;
            color: white;
        }

        .btn-ready {
            background: #00ff00;
            color: black;
        }

        .btn-completed {
            background: #0088ff;
            color: white;
        }

        .btn-print {
            background: var(--primary);
            color: var(--text-dark);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .cart-sidebar {
                max-width: 100%;
            }

            .payment-methods {
                grid-template-columns: 1fr;
            }
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
            color: var(--primary);
        }

        .success-message {
            background: #00C851;
            color: white;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            margin: 1rem 0;
            display: none;
        }

        .error-message {
            background: #ff4444;
            color: white;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            margin: 1rem 0;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="logo">
                ü•û BAR DA TAPIOCA
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <!-- Customer Interface -->
            <div id="customer-interface">
                <div class="categories" id="categories-list">
                    <!-- Categorias ser√£o carregadas via JavaScript -->
                </div>

                <div class="products-grid" id="products-grid">
                    <!-- Produtos ser√£o carregados via JavaScript -->
                </div>
            </div>

            <!-- Admin Login -->
            <div id="admin-login" class="admin-login" style="display: none;">
                <h2 style="text-align: center; color: var(--primary); margin-bottom: 2rem;">√Årea Administrativa</h2>
                <form id="login-form">
                    <div class="form-group">
                        <label for="username">Usu√°rio:</label>
                        <input type="text" id="username" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Senha:</label>
                        <input type="password" id="password" required>
                    </div>
                    <button type="submit" class="checkout-btn">Entrar</button>
                </form>
            </div>

            <!-- Admin Panel -->
            <div id="admin-panel" class="admin-panel" style="display: none;">
                <h2 style="text-align: center; color: var(--primary); margin-bottom: 2rem;">Pedidos - √Årea Administrativa</h2>
                <div class="orders-list" id="orders-list">
                    <!-- Pedidos ser√£o carregados via JavaScript -->
                </div>
            </div>
        </div>
    </main>

    <!-- Cart Toggle -->
    <button class="cart-toggle" id="cart-toggle">
        üõí
        <span class="cart-count" id="cart-count">0</span>
    </button>

    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cart-sidebar">
        <div class="cart-header">
            <h3 style="color: var(--primary);">Seu Pedido</h3>
            <button class="close-cart" id="close-cart">‚úï</button>
        </div>
        
        <div class="cart-items" id="cart-items">
            <!-- Itens do carrinho ser√£o adicionados aqui -->
        </div>

        <div class="cart-total" id="cart-total">Total: R$ 0,00</div>

        <form id="checkout-form" class="checkout-form">
            <div class="form-group">
                <label for="customer-name">Seu Nome:</label>
                <input type="text" id="customer-name" required>
            </div>
            <div class="form-group">
                <label for="customer-whatsapp">WhatsApp:</label>
                <input type="tel" id="customer-whatsapp" required placeholder="(11) 99999-9999">
            </div>
            <div class="form-group">
                <label for="order-notes">Observa√ß√µes:</label>
                <textarea id="order-notes" rows="3" placeholder="Alguma observa√ß√£o especial?"></textarea>
            </div>
            
            <label style="color: var(--primary); font-weight: bold; margin-bottom: 0.5rem;">Forma de Pagamento:</label>
            <div class="payment-methods">
                <div class="payment-method" data-method="dinheiro">üíµ Dinheiro</div>
                <div class="payment-method" data-method="pix">üì± PIX</div>
                <div class="payment-method" data-method="cartao_credito">üí≥ Cart√£o Cr√©dito</div>
                <div class="payment-method" data-method="cartao_debito">üí≥ Cart√£o D√©bito</div>
            </div>
            <input type="hidden" id="payment-method" required>

            <button type="submit" class="checkout-btn">Finalizar Pedido</button>
        </form>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Messages -->
    <div class="success-message" id="success-message"></div>
    <div class="error-message" id="error-message"></div>

    <div class="loading" id="loading">Carregando...</div>

    <script>
        // Configura√ß√µes
        const SUPABASE_URL = 'https://niqyditsjouvhclprtpk.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5pcXlkaXRzam91dmhjbHBydHBrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3MzEyMzIsImV4cCI6MjA3OTMwNzIzMn0.Pnml-SFLT8X38GuQGu7G-mQsrNyvufModJ5N5b9m96s';
        const BACKEND_URL = 'https://backend-tapioca.vercel.app'; // Substitua pela URL do seu backend na Vercel

        // Estado da aplica√ß√£o
        let cart = [];
        let products = [];
        let categories = [];
        let orders = [];
        let selectedPaymentMethod = '';

        // Elementos DOM
        const elements = {
            categoriesList: document.getElementById('categories-list'),
            productsGrid: document.getElementById('products-grid'),
            cartToggle: document.getElementById('cart-toggle'),
            cartSidebar: document.getElementById('cart-sidebar'),
            closeCart: document.getElementById('close-cart'),
            cartItems: document.getElementById('cart-items'),
            cartTotal: document.getElementById('cart-total'),
            cartCount: document.getElementById('cart-count'),
            checkoutForm: document.getElementById('checkout-form'),
            overlay: document.getElementById('overlay'),
            customerInterface: document.getElementById('customer-interface'),
            adminLogin: document.getElementById('admin-login'),
            adminPanel: document.getElementById('admin-panel'),
            loginForm: document.getElementById('login-form'),
            ordersList: document.getElementById('orders-list'),
            successMessage: document.getElementById('success-message'),
            errorMessage: document.getElementById('error-message'),
            loading: document.getElementById('loading')
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            setupEventListeners();
        });

        function initApp() {
            checkRoute();
            if (!isAdminRoute()) {
                loadProducts();
                loadCategories();
            }
        }

        function checkRoute() {
            const hash = window.location.hash;
            if (hash === '#/admin') {
                showAdminLogin();
            } else {
                showCustomerInterface();
            }
        }

        function isAdminRoute() {
            return window.location.hash === '#/admin';
        }

        function showAdminLogin() {
            elements.customerInterface.style.display = 'none';
            elements.adminLogin.style.display = 'block';
            elements.adminPanel.style.display = 'none';
        }

        function showCustomerInterface() {
            elements.customerInterface.style.display = 'block';
            elements.adminLogin.style.display = 'none';
            elements.adminPanel.style.display = 'none';
        }

        function showAdminPanel() {
            elements.customerInterface.style.display = 'none';
            elements.adminLogin.style.display = 'none';
            elements.adminPanel.style.display = 'block';
            loadOrders();
            startOrdersPolling();
        }

        function setupEventListeners() {
            // Carrinho
            elements.cartToggle.addEventListener('click', toggleCart);
            elements.closeCart.addEventListener('click', closeCart);
            elements.overlay.addEventListener('click', closeCart);

            // Pagamento
            document.querySelectorAll('.payment-method').forEach(method => {
                method.addEventListener('click', function() {
                    selectedPaymentMethod = this.getAttribute('data-method');
                    document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
                    this.classList.add('selected');
                    document.getElementById('payment-method').value = selectedPaymentMethod;
                });
            });

            // Checkout
            elements.checkoutForm.addEventListener('submit', handleCheckout);

            // Login Admin
            elements.loginForm.addEventListener('submit', handleAdminLogin);

            // Navega√ß√£o
            window.addEventListener('hashchange', checkRoute);
        }

        async function loadCategories() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/categories?active=eq.true`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                categories = await response.json();
                renderCategories();
            } catch (error) {
                console.error('Erro ao carregar categorias:', error);
            }
        }

        function renderCategories() {
            elements.categoriesList.innerHTML = '';
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'category-btn';
                button.textContent = category.name;
                button.setAttribute('data-category-id', category.id);
                button.addEventListener('click', () => filterProductsByCategory(category.id));
                elements.categoriesList.appendChild(button);
            });
        }

        async function loadProducts() {
            try {
                elements.loading.style.display = 'block';
                const response = await fetch(`${SUPABASE_URL}/rest/v1/products?active=eq.true&select=*,categories(name)`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                products = await response.json();
                renderProducts();
                elements.loading.style.display = 'none';
            } catch (error) {
                console.error('Erro ao carregar produtos:', error);
                elements.loading.style.display = 'none';
            }
        }

        function renderProducts() {
            elements.productsGrid.innerHTML = '';
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <div class="product-image">
                        ${product.image_url ? `<img src="${product.image_url}" alt="${product.name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">` : 'üçΩÔ∏è'}
                    </div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-description">${product.description || ''}</div>
                    <div class="product-price">R$ ${product.price.toFixed(2)}</div>
                    <button class="add-to-cart" data-product-id="${product.id}">
                        Adicionar ao Carrinho
                    </button>
                `;
                elements.productsGrid.appendChild(productCard);
            });

            // Adicionar event listeners aos bot√µes
            document.querySelectorAll('.add-to-cart').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-product-id'));
                    addToCart(productId);
                });
            });
        }

        function filterProductsByCategory(categoryId) {
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const filteredProducts = categoryId ? 
                products.filter(product => product.category_id === categoryId) : 
                products;
            
            renderFilteredProducts(filteredProducts);
        }

        function renderFilteredProducts(filteredProducts) {
            elements.productsGrid.innerHTML = '';
            filteredProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <div class="product-image">
                        ${product.image_url ? `<img src="${product.image_url}" alt="${product.name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">` : 'üçΩÔ∏è'}
                    </div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-description">${product.description || ''}</div>
                    <div class="product-price">R$ ${product.price.toFixed(2)}</div>
                    <button class="add-to-cart" data-product-id="${product.id}">
                        Adicionar ao Carrinho
                    </button>
                `;
                elements.productsGrid.appendChild(productCard);
            });

            document.querySelectorAll('.add-to-cart').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-product-id'));
                    addToCart(productId);
                });
            });
        }

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    ...product,
                    quantity: 1
                });
            }

            updateCart();
            showMessage('Produto adicionado ao carrinho!', 'success');
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCart();
        }

        function updateQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    updateCart();
                }
            }
        }

        function updateCart() {
            elements.cartItems.innerHTML = '';
            let total = 0;

            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;

                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="item-info">
                        <h4>${item.name}</h4>
                        <div>R$ ${item.price.toFixed(2)}</div>
                    </div>
                    <div class="item-quantity">
                        <button class="quantity-btn" onclick="updateQuantity(${item.id}, -1)">-</button>
                        <span>${item.quantity}</span>
                        <button class="quantity-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
                        <button class="remove-item" onclick="removeFromCart(${item.id})">üóëÔ∏è</button>
                    </div>
                `;
                elements.cartItems.appendChild(cartItem);
            });

            elements.cartTotal.textContent = `Total: R$ ${total.toFixed(2)}`;
            elements.cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
        }

        function toggleCart() {
            elements.cartSidebar.classList.toggle('open');
            elements.overlay.classList.toggle('active');
        }

        function closeCart() {
            elements.cartSidebar.classList.remove('open');
            elements.overlay.classList.remove('active');
        }

        async function handleCheckout(event) {
            event.preventDefault();
            
            if (cart.length === 0) {
                showMessage('Seu carrinho est√° vazio!', 'error');
                return;
            }

            if (!selectedPaymentMethod) {
                showMessage('Selecione uma forma de pagamento!', 'error');
                return;
            }

            const formData = new FormData(elements.checkoutForm);
            const orderData = {
                customer_name: formData.get('customer-name'),
                whatsapp: formData.get('customer-whatsapp'),
                items: cart,
                total_amount: cart.reduce((total, item) => total + (item.price * item.quantity), 0),
                payment_method: selectedPaymentMethod,
                notes: formData.get('order-notes'),
                status: 'pending'
            };

            try {
                elements.loading.style.display = 'block';
                const response = await fetch(`${BACKEND_URL}/api/orders`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });

                if (response.ok) {
                    showMessage('Pedido realizado com sucesso! Aguarde nosso contato.', 'success');
                    cart = [];
                    updateCart();
                    closeCart();
                    elements.checkoutForm.reset();
                    selectedPaymentMethod = '';
                    document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
                } else {
                    throw new Error('Erro ao realizar pedido');
                }
            } catch (error) {
                console.error('Erro:', error);
                showMessage('Erro ao realizar pedido. Tente novamente.', 'error');
            } finally {
                elements.loading.style.display = 'none';
            }
        }

        async function handleAdminLogin(event) {
    event.preventDefault();
    
    const formData = new FormData(elements.loginForm);
    const loginData = {
        username: formData.get('username'),
        password: formData.get('password')
    };

    try {
        elements.loading.style.display = 'block';
        console.log('Tentando login:', loginData);
        
        const response = await fetch(`${BACKEND_URL}/api/admin/login`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(loginData)
        });

        console.log('Status da resposta:', response.status);
        
        // Verifica se a resposta √© OK (status 200-299)
        if (response.ok) {
            const data = await response.json();
            console.log('Login bem-sucedido:', data);
            showMessage('Login realizado com sucesso!', 'success');
            showAdminPanel();
        } else {
            // Se n√£o for OK, tenta ler a mensagem de erro
            const errorData = await response.json();
            console.log('Erro do servidor:', errorData);
            throw new Error(errorData.error || 'Credenciais inv√°lidas');
        }
    } catch (error) {
        console.error('Erro no login:', error);
        showMessage(error.message || 'Erro ao fazer login. Tente novamente.', 'error');
    } finally {
        elements.loading.style.display = 'none';
    }
}

        async function loadOrders() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/orders`);
                if (response.ok) {
                    orders = await response.json();
                    renderOrders();
                }
            } catch (error) {
                console.error('Erro ao carregar pedidos:', error);
            }
        }

        function renderOrders() {
            elements.ordersList.innerHTML = '';
            
            orders.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
            
            orders.forEach(order => {
                const orderCard = document.createElement('div');
                orderCard.className = 'order-card';
                
                const itemsHtml = JSON.parse(order.items).map(item => 
                    `<div>${item.quantity}x ${item.name} - R$ ${(item.price * item.quantity).toFixed(2)}</div>`
                ).join('');
                
                orderCard.innerHTML = `
                    <div class="order-header">
                        <div>
                            <h3 style="color: var(--primary);">${order.customer_name}</h3>
                            <div>üì± ${order.whatsapp}</div>
                            <div>üïí ${new Date(order.created_at).toLocaleString('pt-BR')}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.2rem; font-weight: bold; color: var(--primary);">
                                R$ ${order.total_amount}
                            </div>
                            <div style="background: ${getStatusColor(order.status)}; padding: 5px 10px; border-radius: 5px; margin-top: 5px;">
                                ${getStatusText(order.status)}
                            </div>
                        </div>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <strong>Itens:</strong>
                        ${itemsHtml}
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <strong>Pagamento:</strong> ${getPaymentMethodText(order.payment_method)}
                    </div>
                    ${order.notes ? `<div style="margin-bottom: 1rem;"><strong>Observa√ß√µes:</strong> ${order.notes}</div>` : ''}
                    <div class="order-actions">
                        <button class="action-btn btn-preparing" onclick="updateOrderStatus(${order.id}, 'preparing')">
                            üç≥ Preparando
                        </button>
                        <button class="action-btn btn-ready" onclick="updateOrderStatus(${order.id}, 'ready')">
                            ‚úÖ Pronto
                        </button>
                        <button class="action-btn btn-completed" onclick="updateOrderStatus(${order.id}, 'completed')">
                            üéâ Finalizado
                        </button>
                        <button class="action-btn btn-print" onclick="printOrder(${order.id})">
                            üñ®Ô∏è Imprimir
                        </button>
                    </div>
                `;
                
                elements.ordersList.appendChild(orderCard);
            });
        }

        function getStatusColor(status) {
            const colors = {
                'pending': '#ffa500',
                'preparing': '#ffa500',
                'ready': '#00ff00',
                'completed': '#0088ff'
            };
            return colors[status] || '#666';
        }

        function getStatusText(status) {
            const texts = {
                'pending': 'üïí Pendente',
                'preparing': 'üç≥ Em Preparo',
                'ready': '‚úÖ Pronto',
                'completed': 'üéâ Finalizado'
            };
            return texts[status] || status;
        }

        function getPaymentMethodText(method) {
            const texts = {
                'dinheiro': 'üíµ Dinheiro',
                'pix': 'üì± PIX',
                'cartao_credito': 'üí≥ Cart√£o Cr√©dito',
                'cartao_debito': 'üí≥ Cart√£o D√©bito'
            };
            return texts[method] || method;
        }

        async function updateOrderStatus(orderId, status) {
            try {
                const response = await fetch(`${BACKEND_URL}/api/orders/${orderId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ status })
                });

                if (response.ok) {
                    showMessage('Status atualizado com sucesso!', 'success');
                    loadOrders();
                } else {
                    throw new Error('Erro ao atualizar status');
                }
            } catch (error) {
                console.error('Erro:', error);
                showMessage('Erro ao atualizar status', 'error');
            }
        }

        function printOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            const printWindow = window.open('', '_blank');
            const items = JSON.parse(order.items);
            
            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Pedido #${order.id}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 20px; }
                        .info { margin-bottom: 15px; }
                        .items { margin: 15px 0; }
                        .item { display: flex; justify-content: space-between; margin: 5px 0; }
                        .total { font-weight: bold; font-size: 1.2em; text-align: right; margin-top: 15px; }
                        .footer { margin-top: 30px; text-align: center; font-size: 0.9em; color: #666; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>BAR DA TAPIOCA</h1>
                        <h2>PEDIDO #${order.id}</h2>
                    </div>
                    
                    <div class="info">
                        <strong>Cliente:</strong> ${order.customer_name}<br>
                        <strong>WhatsApp:</strong> ${order.whatsapp}<br>
                        <strong>Data:</strong> ${new Date(order.created_at).toLocaleString('pt-BR')}<br>
                        <strong>Pagamento:</strong> ${getPaymentMethodText(order.payment_method)}<br>
                        ${order.notes ? `<strong>Observa√ß√µes:</strong> ${order.notes}<br>` : ''}
                    </div>
                    
                    <div class="items">
                        <strong>ITENS:</strong>
                        ${items.map(item => `
                            <div class="item">
                                <span>${item.quantity}x ${item.name}</span>
                                <span>R$ ${(item.price * item.quantity).toFixed(2)}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="total">
                        TOTAL: R$ ${order.total_amount}
                    </div>
                    
                    <div class="footer">
                        Obrigado pela prefer√™ncia! ü•û
                    </div>
                </body>
                </html>
            `;

            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }

        function startOrdersPolling() {
            setInterval(loadOrders, 10000); // Atualiza a cada 10 segundos
        }

        function showMessage(message, type) {
            const messageElement = type === 'success' ? elements.successMessage : elements.errorMessage;
            messageElement.textContent = message;
            messageElement.style.display = 'block';
            
            setTimeout(() => {
                messageElement.style.display = 'none';
            }, 5000);
        }

        // Fun√ß√µes globais para uso nos event listeners
        window.updateQuantity = updateQuantity;
        window.removeFromCart = removeFromCart;
        window.updateOrderStatus = updateOrderStatus;
        window.printOrder = printOrder;
    </script>
</body>
</html>